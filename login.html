<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABN Utilities | Digital Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">
      <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary: #48bb78;
            --primary-dark: #38a169;
            --glass: rgba(255, 255, 255, 0.1);
            --border: rgba(255, 255, 255, 0.2);
            --bg-dark: #1a202c;
        }

        * { box-sizing: border-box; scroll-behavior: smooth; }

        body {
            margin: 0; font-family: 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(rgba(0,0,0,0.75), rgba(0,0,0,0.75)), url('assets/background.webp');
            background-size: cover; background-position: center; background-attachment: fixed;
            color: white; overflow-x: hidden;
        }

/* --- NAVIGATION --- */
        nav {
            position: fixed; top: 0; width: 100%; padding: 15px 5%;
            display: flex; justify-content: space-between; align-items: center;
            z-index: 1000; transition: 0.4s;
        }
        nav.scrolled { background: rgba(26, 32, 44, 0.95); padding: 10px 5%; border-bottom: 1px solid var(--border); }

        .logo-container { display: flex; align-items: center; gap: 10px; }
        .nav-logo { height: 40px; width: auto; filter: drop-shadow(0 0 5px rgba(255,255,255,0.2)); }
        .logo-text { font-weight: bold; font-size: 1.2rem; letter-spacing: 1px; }

        .nav-links { display: none; } /* Hidden on mobile by default */

        @media (min-width: 1024px) {
            .nav-links { display: block; }
            .nav-links a { color: white; text-decoration: none; margin-left: 25px; font-weight: 500; transition: 0.3s; }
            .nav-links a:hover { color: var(--primary); }
            .logo-text { font-size: 1.5rem; }
        }

/* --- HERO & LOGIN SECTION --- */
        .hero { 
            min-height: 100vh; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; padding: 100px 5% 50px;
        }

        .info-side { text-align: center; margin-bottom: 40px; }
        .info-side h1 { font-size: 2.8rem; margin: 0; color: var(--primary); line-height: 1.1; }
        .info-side p { font-size: 1rem; line-height: 1.6; color: #cbd5e0; max-width: 500px; margin: 20px auto; }

        .login-side { width: 100%; display: flex; justify-content: center; }

        .glass-box {
            background: var(--glass); backdrop-filter: blur(15px);
            border: 1px solid var(--border); border-radius: 25px;
            padding: 30px 20px; width: 100%; max-width: 400px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        @media (min-width: 1024px) {
            .hero { flex-direction: row; text-align: left; padding: 0 10%; justify-content: space-between; }
            .info-side { text-align: left; flex: 1; margin-bottom: 0; padding-right: 50px; }
            .info-side h1 { font-size: 4rem; }
            .info-side p { margin: 25px 0; font-size: 1.15rem; }
            .login-side { flex: 0.8; justify-content: flex-end; }
        }

/* --- INPUTS & BUTTONS --- */
        .input-group { margin-bottom: 18px; position: relative; text-align: left; }
        .input-group label { display: block; margin-bottom: 6px; font-size: 0.85rem; color: #a0aec0; }
        .input-group input, .input-group select {
            width: 100%; padding: 12px 15px; background: rgba(255,255,255,0.05);
            border: 1px solid var(--border); border-radius: 10px; color: white; outline: none; transition: 0.3s;
        }
        .input-group input:focus { border-color: var(--primary); background: rgba(255,255,255,0.1); }

        .login-btn {
            width: 100%; padding: 15px; background: var(--primary); border: none;
            border-radius: 10px; color: white; font-weight: bold; cursor: pointer; transition: 0.3s;
        }
        .login-btn:hover { background: var(--primary-dark); transform: translateY(-2px); }

/* --- AREAS SECTION --- */
        .about-section { padding: 80px 5%; background: var(--bg-dark); }
        .grid-areas {
            display: grid; grid-template-columns: 1fr; gap: 20px; margin-top: 40px;
        }

        @media (min-width: 640px) { .grid-areas { grid-template-columns: repeat(2, 1fr); } }
        @media (min-width: 1024px) { .grid-areas { grid-template-columns: repeat(4, 1fr); } }

        .area-card {
            background: var(--glass); padding: 25px; border-radius: 20px;
            border: 1px solid var(--border); text-align: center; transition: 0.4s;
        }
        .area-card:hover { transform: translateY(-10px); border-color: var(--primary); }
        .area-card i { font-size: 2rem; color: var(--primary); margin-bottom: 15px; }
        .area-card h3 { margin: 10px 0; font-size: 1.2rem; }
        .area-card p { font-size: 0.85rem; color: #a0aec0; line-height: 1.5; }

/* --- REGISTER FORM EXTRA ---*/ 
        #register-form { max-height: 85vh; overflow-y: auto; }
        #register-form::-webkit-scrollbar { width: 4px; }
        #register-form::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }
        
        .avatar-grid { 
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; 
            background: rgba(0,0,0,0.2); padding: 10px; border-radius: 10px; margin-bottom: 15px;
        }
        .avatar-item { width: 100%; cursor: pointer; border-radius: 50%; border: 2px solid transparent; transition: 0.2s; }
        .avatar-item.selected { border-color: var(--primary); transform: scale(1.1); }
        </style>
    

        </head>
        <body>
        <nav id="navbar">
        <div class="logo-container">
        <img src="assets/abnlogo.png" alt="Logo" class="nav-logo">
        <div class="logo-text">ABN <span style="color: var(--primary);">UTILITIES</span></div>
        </div>
        <div class="nav-links">
            <a href="#">Home</a>
            <a href="#about">Areas</a>
            <a href="#" onclick="toggleForms()">Sign In</a>
        </div>
        </nav>
       <section class="hero">
    <div class="info-side">
        <h1>Digital Utilities Operation (DUO)</h1>
        <p>
            <span style="color: var(--primary); font-weight: 600;">Empowering Utility Management.</span> 
            Our mission is to transition from legacy manual documentation to a real-time data ecosystemâ€”eliminating paper waste and automating workloads for technical excellence.
        </p>
        <button class="login-btn" style="max-width: 250px;" onclick="document.getElementById('about').scrollIntoView()">
            Explore Areas <i class="fas fa-arrow-right" style="margin-left: 10px;"></i>
        </button>
    </div>
    
    <div class="login-side">
        <div id="login-form" class="glass-box">
            <h2 style="text-align:center; margin-top:0;">Welcome Back</h2>
            
            <div class="input-group">
                <label>Company ID</label>
                <input type="text" id="loginID" placeholder="Enter ID">
            </div>

            <div class="input-group">
                <label>Password</label>
                <div style="position: relative;">
                    <input type="password" id="loginPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    <i class="fas fa-eye toggle-pass" 
                       style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: gray;" 
                       onclick="togglePassword('loginPass', this)">
                    </i>
                </div>
            </div>

            <button class="login-btn" onclick="handleLogin()">SIGN IN</button>
            <p style="text-align:center; font-size: 0.85rem; margin-top: 20px; cursor:pointer;" onclick="toggleForms()">
                No account? <span style="color:var(--primary)">Register</span>
            </p>
        </div>

        <div id="register-form" class="glass-box" style="display:none;">
            <h2 style="text-align:center; margin-top:0;">Create Account</h2>
            
            <div class="input-group">
                <label>Full Name</label>
                <input type="text" id="regName" placeholder="Juan Dela Cruz">
            </div>

            <div style="display:flex; gap:10px; margin-bottom:15px;" id="regRow">
                    <div style="flex:1">
                    <label style="font-size:0.8rem; color:gray;">ID</label>
                     <input type="text" id="regID" placeholder="0000" style="width:100%; padding:10px; background:rgba(255,255,255,0.05); border:1px solid var(--border); border-radius:10px; color:white;">
                    </div>
                    <div style="flex:1">
                     <label style="font-size:0.8rem; color:gray;">Role</label>
                    <select id="regRole" style="width:100%; padding:10px; background:rgba(255,255,255,0.05); border:1px solid var(--border); border-radius:10px; color:white;">
                         <option value="mantech" style="background:#2d3748;">Mantech</option>
                         <option value="opscrew" style="background:#2d3748;">OpsCrew</option>
                        <option value="supervisor" style="background:#2d3748;">Supervisor</option>
                    </select>
                </div>
            </div>

            <div class="input-group">
                <label>Birthday</label>
                <input type="date" id="regDOB">
            </div>

            <label style="font-size: 0.8rem; color:gray; display:block; margin-bottom:10px;">Select Avatar</label>
            <div class="avatar-grid" id="avatarGrid"></div>

            <div class="input-group">
                <label>Password</label>
                <div style="position: relative;">
                    <input type="password" id="regPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    <i class="fas fa-eye toggle-pass" 
                       style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: gray;" 
                       onclick="togglePassword('regPass', this)">
                    </i>
                </div>
            </div>

            <button class="login-btn" onclick="handleRegister()">REGISTER</button>
            <p style="text-align:center; font-size: 0.85rem; margin-top: 15px; cursor:pointer;" onclick="toggleForms()">Back to Login</p>
        </div>
    </div>
</section>

    

        <section class="about-section" id="about">
        <h2 style="text-align:center; font-size: 2rem; margin: 0 0 10px 0;">Utility Areas</h2>
        <p style="text-align:center; color:#a0aec0; margin-bottom:40px;">Specialized monitoring for plant-wide reliability.</p>
        
        <div class="grid-areas">
            <div class="area-card"><i class="fas fa-fire"></i><h3>Boiler</h3><p>Steam production & fuel efficiency monitoring.</p></div>
            <div class="area-card"><i class="fas fa-snowflake"></i><h3>Ref</h3><p>Cold storage & ammonia system safety.</p></div>
            <div class="area-card"><i class="fas fa-wind"></i><h3>CDA</h3><p>Compressed air supply for pneumatic machines.</p></div>
            <div class="area-card"><i class="fas fa-database"></i><h3>CWS</h3><p>Water storage & Deepwell pump controls.</p></div>
            <div class="area-card" style="border-top:3px solid #4299e1;"><i class="fas fa-faucet" style="color:#4299e1"></i><h3>WTP</h3><p>RO Purification for production process water.</p></div>
            <div class="area-card" style="border-top:3px solid #f56565;"><i class="fas fa-recycle" style="color:#f56565"></i><h3>WWTP</h3><p>Effluent treatment & environmental compliance.</p></div>
            <div class="area-card"><i class="fas fa-flask"></i><h3>Chemicals</h3><p>Dry & Wet chemical inventory tracking.</p></div>
            <div class="area-card"><i class="fas fa-bolt"></i><h3>Power</h3><p>kWh consumption & peak demand analytics.</p></div>
        </div>
        </section>

            
        <script>
// SUPABASE config 
        const SB_URL = "https://qbeacrpoyfacgmbzxjcu.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFiZWFjcnBveWZhY2dtYnp4amN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg2NTM5NTIsImV4cCI6MjA2NDIyOTk1Mn0.6kfxKLJxidW4BcqsMJte61AtzydrTW-1ZJIJytiUBt4";
        const supabaseClient = supabase.createClient(SB_URL, SB_KEY);

// UI LOGIC
        window.addEventListener('scroll', () => {
        const nav = document.getElementById('navbar');
        if (window.scrollY > 50) nav.classList.add('scrolled');
        else nav.classList.remove('scrolled');
        });
            
    function togglePassword(id, el) {
     const input = document.getElementById(id);
     if (input.type === 'password') {
        input.type = 'text';
        el.classList.replace('fa-eye', 'fa-eye-slash');
        } else {
        input.type = 'password';
        el.classList.replace('fa-eye-slash', 'fa-eye');
        }
        }

    function toggleForms() {
     const login = document.getElementById('login-form');
     const register = document.getElementById('register-form');
     if(login.style.display === 'none') {
        login.style.display = 'block'; register.style.display = 'none';
        } else {
        login.style.display = 'none'; register.style.display = 'block';
        loadAvatars();
        }
        }
// --- Avatar Selection SECTION ---
    function loadAvatars() {
     const grid = document.getElementById('avatarGrid');
     grid.innerHTML = "";
     for(let i=1; i<=20; i++) {
        grid.innerHTML += `<img src="assets/avatar${i}.svg" class="avatar-item" onclick="selectAvatar(this, 'avatar${i}.svg')">`;
        }
        }
     let selectedAvatar = "";
    function selectAvatar(el, name) {
        document.querySelectorAll('.avatar-item').forEach(img => img.classList.remove('selected'));
        el.classList.add('selected');
        selectedAvatar = name;
        }
    
// --- REgister SECTION ---
    async function handleRegister() {
    const id = document.getElementById('regID').value;
    const name = document.getElementById('regName').value;
    const dob = document.getElementById('regDOB').value;
    const role = document.getElementById('regRole').value;
    const pass = document.getElementById('regPass').value;
    if(!id || !name || !selectedAvatar || !pass || !dob) return alert("Please fill all fields!");
    const { error } = await supabaseClient.from('profiles').insert([
        { 
            company_id: id, 
            full_name: name, 
            dob: dob, 
            role: role, 
            avatar_url: selectedAvatar, 
            password: pass,
            is_approved: false // <--- ITO ANG PINAKA-IMPORTANTE
        }
    ]);
    if(error) {
        alert("Registration Error: " + error.message);
    } else { 
        alert("Account created successfully! ðŸ“ Please wait for the Supervisor (Visor) to approve your account before logging in."); 
        toggleForms(); 
    }
    }

    async function handleLogin() {
    const id = document.getElementById('loginID').value;
    const pass = document.getElementById('loginPass').value;
// 1. Kunin ang data sa Supabase (Dito na dadaan lahat, pati Admin)
    const { data, error } = await supabaseClient
        .from('profiles')
        .select('*')
        .eq('company_id', id)
        .eq('password', pass)
        .single();
        if (data) {
// 2. SECURITY GATE: I-check kung Approved
// (Note: Sa Supabase, siguraduhin na ang Admin/Supervisor ay 'is_approved: true')
        if (data.is_approved === false) {
            alert("âš ï¸ ACCESS PENDING: Your account is not yet approved by the Visor.");
            return; 
        }
// 3. Save session at i-redirect base sa role
        saveSession(data.company_id, data.full_name, data.role, data.avatar_url);     
// Kung supervisor, sa index.html (Dashboard). Kung mantech, sa tools.html.
        window.location.href = (data.role === 'supervisor') ? "index.html" : "tools.html";
        } else { 
        alert("Invalid ID or Password!"); 
        }
        } 
            
        function saveSession(id, name, role, avatar) {
            localStorage.setItem('userCode', id);
            localStorage.setItem('userName', name);
            localStorage.setItem('userRole', role);
            localStorage.setItem('userAvatar', avatar);
        }
</script>
</body>
</html>
